# Better-Tunnel 🚀

یک ابزار تونلینگ با **عملکرد بالا**، **پنهان‌کار** و **پایدار** که برای عبور از محدودیت‌های شبکه و در دسترس قرار دادن امن سرویس‌های محلی طراحی شده است.

این ابزار ترافیک را در یک اتصال استاندارد WebSocket روی TLS (WSS) کپسوله می‌کند، که باعث می‌شود از ترافیک وب عادی و امن قابل تشخیص نباشد. همچنین با استفاده از مالتی‌پلکسینگ، هزاران اتصال همزمان را روی یک تونل پایدار مدیریت می‌کند.

## قابلیت‌های کلیدی

-   **ترافیک پنهان (Stealth)**: ترافیک را درون WebSocket روی TLS (WSS) مخفی می‌کند و به طور موثر سیستم‌های بازرسی عمیق بسته (DPI) را دور می‌زند.
-   **عملکرد بالا**: با استفاده از مالتی‌پلکسینگ (`yamux`)، اتصالات پرتعداد را به صورت بهینه روی یک اتصال TCP واحد مدیریت می‌کند.
-   **پایداری بالا**: کلاینت در صورت قطع شدن ارتباط، به طور خودکار به سرور متصل می‌شود.
-   **سادگی**: یک فایل اجرایی واحد و بدون وابستگی که می‌تواند هم به عنوان کلاینت و هم سرور عمل کند.
-   **نصب آسان**: همراه با یک اسکریپت `install.sh` برای راه‌اندازی سریع روی سیستم‌های لینوکس.

## چگونه کار می‌کند؟

کلاینت یک اتصال پایدار و امن WebSocket (WSS) به سرور برقرار می‌کند. این اتصال به عنوان "تونل" اصلی ما عمل می‌کند. سپس ما از `yamux` برای ایجاد یک نشست مالتی‌پلکس (چند مسیره) روی این تونل استفاده می‌کنیم.

هنگامی که یک درخواست جدید به پورت عمومی سرور می‌رسد، سرور به جای ایجاد یک اتصال شبکه جدید، به سادگی یک "استریم" (stream) جدید در داخل نشست `yamux` باز می‌کند. کلاینت این استریم را دریافت کرده و داده‌ها را به سرویس محلی پیکربندی شده پراکسی می‌کند. این معماری بسیار کارآمد بوده و شناسایی آن دشوار است.

## نصب

شما به راحتی می‌توانید `better-tunnel` را با استفاده از اسکریپت نصب روی هر سیستم لینوکسی نصب کنید.

۱. **کلون کردن مخزن (repository):**
    ```bash
    git clone https://github.com/your-username/better-tunnel.git
    cd better-tunnel
    ```

۲. **قابل اجرا کردن اسکریپت:**
    ```bash
    chmod +x install.sh
    ```

۳. **اجرای اسکریپت نصب با sudo:**
    ```bash
    sudo ./install.sh
    ```

این اسکریپت کد را کامپایل کرده و فایل اجرایی `better-tunnel` را در مسیر `/usr/local/bin` قرار می‌دهد که باعث می‌شود از هر جای سیستم قابل دسترس باشد.

## نحوه استفاده

`better-tunnel` می‌تواند در دو حالت `server` و `client` اجرا شود.

### حالت سرور (Server Mode)

این حالت را روی یک سرور با IP عمومی (مانند یک VPS) اجرا کنید.

**۱. تولید گواهی TLS:**
ابتدا به یک گواهی و کلید خصوصی TLS نیاز دارید. برای تست، می‌توانید یک گواهی خودامضا (self-signed) ایجاد کنید:
```bash
openssl req -x509 -newkey rsa:4096 -keyout server.key -out server.crt -sha256 -days 3650 -nodes -subj "/CN=your.server.ip"
```
فایل‌های `server.crt` و `server.key` را در همان پوشه‌ای قرار دهید که سرور را اجرا می‌کنید.

**۲. اجرای سرور:**
```bash
# پیشنهاد می‌شود از یک مسیر URL غیر استاندارد و مخفی استفاده کنید.
# استفاده از پورت 443 به دسترسی روت (sudo) نیاز دارد.
sudo better-tunnel server \
  -listen :443 \
  -public :8000 \
  -path /a1b2c3d4e5-secret-path
```
-   `-listen :443`: پورتی که تونل امن WebSocket روی آن گوش می‌دهد. پورت `443` استاندارد HTTPS بوده و برای پنهان‌کاری بهترین گزینه است.
-   `-public :8000`: پورت عمومی که ترافیک کاربران را دریافت کرده و به داخل تونل هدایت می‌کند.
-   `-path /...`: یک مسیر URL مخفی. این کار پیدا کردن نقطه پایانی تونل شما را برای اسکنرها دشوارتر می‌کند.

### حالت کلاینت (Client Mode)

این حالت را روی ماشینی اجرا کنید که سرویس محلی مورد نظر شما روی آن قرار دارد (مانند یک VPS دیگر یا کامپیوتر شخصی).

**اجرای کلاینت:**
```bash
better-tunnel client \
  -server wss://your.server.ip/a1b2c3d4e5-secret-path \
  -local localhost:3000
```
-   `-server wss://...`: آدرس کامل و امن WebSocket سرور شما. **دقت کنید که دقیقاً از همان مسیر مخفی که در سرور تنظیم کرده‌اید استفاده کنید.**
-   `-local localhost:3000`: آدرس سرویس محلی که می‌خواهید در دسترس قرار دهید (مثلاً یک وب سرور، دیتابیس یا SSH).

اکنون، هر ترافیکی که به آدرس `your.server.ip:8000` ارسال شود، به صورت امن به `localhost:3000` روی ماشین کلاینت هدایت خواهد شد.
